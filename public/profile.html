<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>User Profile</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f8f9fa;
        }
        .container {
            margin-top: 50px;
            border-radius: 10px;
            background-color: #ffffff;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        .profile-picture {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 2px solid #007bff;
            margin-bottom: 20px;
        }
        .btn-primary {
            background-color: #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="text-center">User Profile</h2>
        <div class="text-center">
            <img id="profileImage" src="" alt="Profile Picture" class="profile-picture" />
        </div>
        <form id="profileForm" enctype="multipart/form-data">
            <div class="form-group">
                <label for="name">Name:</label>
                <input type="text" class="form-control" id="name" placeholder="Enter your name" required>
            </div>
            <div class="form-group">
                <label for="description">Description:</label>
                <textarea class="form-control" id="description" rows="4" placeholder="Tell us about yourself" required></textarea>
            </div>
            <div class="form-group">
                <label for="contactDetails">Contact Details:</label>
                <input type="text" class="form-control" id="contactDetails" placeholder="Enter your contact details" required>
            </div>
            <div class="form-group">
                <label for="profilePicture">Profile Picture:</label>
                <input type="file" class="form-control-file" id="profilePicture">
            </div>
            <button type="submit" class="btn btn-primary btn-block">Update Profile</button>
        </form>
        <button id="loadProfile" class="btn btn-secondary btn-block mt-2">Load Profile</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loadProfileButton = document.getElementById('loadProfile');
            const profileForm = document.getElementById('profileForm');
            const profileImage = document.getElementById('profileImage');

            // Load Profile
            loadProfileButton.addEventListener('click', async () => {
                const sessionId = localStorage.getItem('sessionId');
                const response = await fetch('/getProfile', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ sessionId })
                });
                const data = await response.json();

                if (data.success) {
                    const { name, description, contactDetails, profilePicture } = data.profile;
                    document.getElementById('name').value = name || '';
                    document.getElementById('description').value = description || '';
                    document.getElementById('contactDetails').value = contactDetails || '';
                    profileImage.src = profilePicture || 'default-profile.png'; // Set a default image if none exists
                } else {
                    alert(data.message);
                }
            });

            // Update Profile
            profileForm.addEventListener('submit', async (event) => {
                event.preventDefault();

                const formData = new FormData(profileForm);
                formData.append('sessionId', localStorage.getItem('sessionId'));

                const response = await fetch('/updateProfile', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                if (data.success) {
                    alert(data.message);
                    loadProfileButton.click(); // Load updated profile
                } else {
                    alert(data.message);
                }
            });
        });
    </script>
</body>
</html>
